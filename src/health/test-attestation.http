# Health API Attestation Tests
# This file contains HTTP requests to test the attestation functionality
# You can use a REST client like VS Code's REST Client extension to run these requests

@baseUrl = http://localhost:3000
@authToken = YOUR_JWT_TOKEN_HERE

### 1. Get an attestation nonce
GET {{baseUrl}}/health/attestation-nonce
Authorization: Bearer {{authToken}}

### 2. Submit health data with valid attestation (Android)
# Replace the nonce value with one obtained from the previous request
POST {{baseUrl}}/health
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "nonce": "REPLACE_WITH_ACTUAL_NONCE",
  "attestationToken": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjEiLCJ0eXAiOiJKV1QifQ...",
  "platform": "android",
  "steps": 8500,
  "duration": 3600,
  "calories": 350.5,
  "distance": 5200.75,
  "source": "android_health",
  "date": "2025-07-25"
}

### 3. Submit health data with valid attestation (iOS)
# Replace the nonce value with one obtained from the first request
POST {{baseUrl}}/health
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "nonce": "REPLACE_WITH_ACTUAL_NONCE",
  "attestationToken": "MIIB1zCCAXygAwIBAgIQaLsRJRLvVq/4X7C+vUdJ+jAKBggqhkjOPQQDAjA...",
  "platform": "ios",
  "steps": 7200,
  "duration": 3000,
  "calories": 320.0,
  "distance": 4800.5,
  "source": "ios_health",
  "date": "2025-07-25"
}

### 4. Test error: Submit with expired or used nonce
# Use a nonce that has already been used in a previous request
POST {{baseUrl}}/health
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "nonce": "REPLACE_WITH_USED_NONCE",
  "attestationToken": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjEiLCJ0eXAiOiJKV1QifQ...",
  "platform": "android",
  "steps": 8500,
  "duration": 3600,
  "calories": 350.5,
  "distance": 5200.75,
  "source": "android_health",
  "date": "2025-07-25"
}

### 5. Test error: Submit with implausible health data
POST {{baseUrl}}/health
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "nonce": "REPLACE_WITH_ACTUAL_NONCE",
  "attestationToken": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjEiLCJ0eXAiOiJKV1QifQ...",
  "platform": "android",
  "steps": 150000,
  "duration": 3600,
  "calories": 350.5,
  "distance": 5200.75,
  "source": "android_health",
  "date": "2025-07-25"
}

### 6. Test error: Submit with unsupported platform
POST {{baseUrl}}/health
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "nonce": "REPLACE_WITH_ACTUAL_NONCE",
  "attestationToken": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjEiLCJ0eXAiOiJKV1QifQ...",
  "platform": "windows",
  "steps": 8500,
  "duration": 3600,
  "calories": 350.5,
  "distance": 5200.75,
  "source": "windows_health",
  "date": "2025-07-25"
}